---
config:
  theme: neutral
  look: handDrawn
---
sequenceDiagram
  participant User
  participant Frontend
  participant Gateway
  participant ExecutionService
  participant EventBus
  participant DB
  participant DLQ
  User->>Frontend: Auftrag löschen klicken
  Frontend->>Gateway: DELETE /auftrag/{id}
  Gateway->>ExecutionService: Auftrag löschen starten
  ExecutionService->>EventBus: emit "auftrag.delete.requested"
  EventBus->>ExecutionService: ack
  ExecutionService->>DB: Markiere als "PENDING_DELETE"
  ExecutionService->>DB: Prüfe Abhängigkeiten (Dokumente, Services, etc.)
  alt Keine Abhängigkeiten
    ExecutionService->>DB: Auftrag endgültig löschen
    ExecutionService->>EventBus: emit "auftrag.deleted"
  else Fehler/Timeout
    ExecutionService->>EventBus: emit "auftrag.delete.failed"
    EventBus->>DLQ: Speichern zur späteren Analyse
  end
  ExecutionService->>Frontend: Status zurückgeben (success/failure)
